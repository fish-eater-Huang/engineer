# 工程CAN总线/串口设备拓扑

## 设备汇总

### CAN

机械臂：关节电机（MIT）×6，气泵电机（DJI）×1，关节编码器（CAN）×3 (?1)

平台：云台电机（DJI）×2，气泵电机（DJI）×2，转轴电机（MIT）×1

底盘：轮电机（DJI）×4，救援电机（DJI）x2 (?2)

### 串口

机械臂：关节编码器（BUS协议）×3 (?1)，控制器离线调试口

平台：minipc，图传串口（自定义控制器），机械臂 (?3)

底盘：裁判系统

## 方案1（机械臂模块化）

整车一个主控（A板），机械臂单独一块控制板（A/C板）

### 机械臂CAN

1. 关节电机（MIT）×6，分2路CAN，333/666Hz，单路每ms收发占用2/4个包
2. (\*)关节编码器（CAN）×3，分2路CAN，与关节电机对应，500Hz/1000Hz，单路每ms收发占用1.5/3个包
3. 有2个包的余量，也可以将机械臂末端气泵电机包含进机械臂模块

### 机械臂UART

1. 整车主控。主控->机械臂：8位状态+12×float/int16目标参数+（8+16位）轨迹规划参数；机械臂->主控：8位状态反馈+8位电机状态反馈+12×float/int16反馈参数+8位轨迹规划状态反馈
2. (\*)编码器-RS485转TTL模块

### 整车CAN

1. 机械臂气泵电机（DJI）×1，线材与摄像头线一束
2. 云台电机（DJI）×2
3. 存矿气泵电机（DJI）×2
4. 转轴电机（MIT）×1
5. 轮电机（DJI）×4
6. 救援电机（DJI）x2

共有DJI电机×11，MIT电机×1

- CAN1：气泵电机（DJI）×3+云台电机（DJI）×2+转轴电机（MIT）×1，每ms占用5+2+2×0.5=8
- CAN2：轮电机（DJI）×4+救援电机（DJI）x2，每ms占用6+2=8（可降至7）

或

- CAN1：气泵电机（DJI）×3+云台电机（DJI）×2，每ms占用5+2=7
- CAN2：轮电机（DJI）×4+救援电机（DJI）x2+转轴电机（MIT）×1，每ms占用6+2×0.5+2×0.5=8

### 整车UART

1. 遥控器接收机（DBUS）
2. 机械臂UART
3. 裁判系统
4. minipc
5. 图传串口/兼用离线调试口（通信协议区分）
6. debug串口（USB）

## 方案2（底盘模块化）

上部平台主控（包含机械臂、云台、气泵，A板）+底盘模块（轮电机+救援?，A/C板）

### 主控CAN

1. 关节电机（MIT）×6，分2路CAN，333Hz，单路每ms收发占用2个包
2. (\*)关节编码器（CAN）×3，分2路CAN，与关节电机对应，500Hz，单路每ms收发占用1.5个包
3. 气泵电机（DJI）×3，每ms收发占用4个包
4. 云台电机（DJI）×2，每ms收发占用3个包
5. 底盘控制板，每ms收发占用2个包，发总状态+底盘速度（3×int16）+救援状态，收总状态+底盘速度（3×int16）+救援状态

- CAN1：关节电机（MIT）×3（666Hz，4/ms）+关节编码器（CAN）×1（500Hz，0.5/ms）+云台电机（DJI）×2（3/ms）+底盘控制板（2/ms）=8.5/ms
- CAN2：关节电机（MIT）×3（666Hz，4/ms）+关节编码器（CAN）×2（500Hz，1/ms）+气泵电机（DJI）×3（4/ms）=9/ms

### 主控UART

1. 遥控器接收机（DBUS）
2. 裁判系统
3. minipc
4. 图传串口/兼用离线调试口（通信协议区分）
5. (\*)编码器-RS485转TTL模块
6. debug串口（USB）

### 底盘CAN

1. CAN1，主控板
2. CAN2，轮电机（DJI）×4
3. 救援电机（DJI）x2

### 底盘UART（无）
